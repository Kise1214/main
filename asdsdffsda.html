document.addEventListener('DOMContentLoaded', () => {
  calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
    initialView: 'dayGridMonth',
    height: 'auto',
    initialDate: today,
    headerToolbar: {
      left: 'prev,next today',
      center: 'title',
      right: ''
    },

    dateClick(info) {
      const title = prompt('ì¼ì • ì œëª© ì…ë ¥');
      if (!title) return;

      db.collection('events').add({
        title: title,
        date: info.dateStr,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
    },

    eventClick(info) {
      const action = prompt(
        `1: ìˆ˜ì •\n2: ì‚­ì œ\n(ìˆ«ì ì…ë ¥)`
      );

      if (action === '1') {
        const newTitle = prompt('ìƒˆ ì¼ì • ì œëª©', info.event.title);
        if (newTitle) {
          db.collection('events')
            .doc(info.event.id)
            .update({ title: newTitle });
        }
      }

      if (action === '2') {
        if (confirm('ì •ë§ ì‚­ì œí• ê¹Œ?')) {
          db.collection('events')
            .doc(info.event.id)
            .delete();
        }
      }
    }
  });

  calendar.render();

  // ğŸ”¥ ì‹¤ì‹œê°„ ë°˜ì˜ í•µì‹¬
  db.collection('events')
    .orderBy('date')
    .onSnapshot(snapshot => {
      calendar.removeAllEvents();

      snapshot.forEach(doc => {
        const data = doc.data();
        calendar.addEvent({
          id: doc.id,
          title: data.title,
          start: data.date
        });
      });
    });
});
