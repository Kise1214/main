<!-- âš ï¸ ì „ì²´ ì½”ë“œë¼ ê¸¸ì–´ë„ ê·¸ëŒ€ë¡œ ì‚¬ìš© -->
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Study Planner</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
:root {
  --primary:#1e88e5; --bg:#fff; --text:#000; --border:#ccc;
}
body.dark { --bg:#121212; --text:#fff; --border:#444; }
body { margin:0; font-family:Arial; background:var(--bg); color:var(--text); }

.hidden{display:none}
header{background:var(--primary);color:#fff;padding:12px;display:flex;justify-content:space-between}
#calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
.day{border:1px solid var(--border);padding:6px;min-height:80px;border-radius:6px;position:relative}
.today{border:2px solid var(--primary)}
.dot{width:6px;height:6px;background:var(--primary);border-radius:50%;position:absolute;bottom:6px;left:50%;transform:translateX(-50%)}
.icon{cursor:pointer;margin-left:6px}
.schedule-item, .todo-item{display:flex;justify-content:space-between;margin:6px 0}
</style>
</head>

<body>

<header>
  <div>ğŸ“˜ Study Planner</div>
  <div>
    <button onclick="toggleDark()">ğŸŒ™</button>
    <button onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
  </div>
</header>

<main style="padding:15px">
  <button id="loginBtn">Google ë¡œê·¸ì¸</button>

  <h3>ğŸ“… ìº˜ë¦°ë”</h3>
  <div id="calendar"></div>

  <h3>ğŸ“Œ ì„ íƒí•œ ë‚ ì§œ ì¼ì •</h3>
  <div id="scheduleList"></div>

  <h3>âœ… ì˜¤ëŠ˜ í•  ì¼</h3>
  <input id="todoInput" placeholder="í•  ì¼ ì…ë ¥" />
  <button onclick="addTodo()">â•</button>
  <div id="todoList"></div>

  <h3>â± ê³µë¶€ ì‹œê°„</h3>
  <button onclick="startStudy()">â–¶ï¸ ì‹œì‘</button>
  <button onclick="stopStudy()">â¹ ì¢…ë£Œ</button>
  <div id="studyTime"></div>
</main>

<script>
/* Firebase */
const firebaseConfig = {
  apiKey: "ì—¬ê¸°ì—",
  authDomain: "ì—¬ê¸°ì—",
  projectId: "ì—¬ê¸°ì—"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let user;
auth.onAuthStateChanged(u=>{
  user=u;
  if(u){
    loginBtn.classList.add("hidden");
    drawCalendar();
    loadTodos();
    loadStudyTime();
  }
});

/* ë¡œê·¸ì¸ */
loginBtn.onclick=()=>auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
function logout(){auth.signOut()}
function toggleDark(){document.body.classList.toggle("dark")}

/* ë‚ ì§œ */
const today=new Date();
const todayStr=today.toISOString().split("T")[0];
let selectedDate=todayStr;

/* ğŸ“… ìº˜ë¦°ë” */
async function drawCalendar(){
  calendar.innerHTML="";
  const last=new Date(today.getFullYear(),today.getMonth()+1,0).getDate();
  const snap=await db.collection("schedules").where("uid","==",user.uid).get();
  const dates=snap.docs.map(d=>d.data().date);

  for(let i=1;i<=last;i++){
    const dateStr=`${today.getFullYear()}-${today.getMonth()+1}-${i}`;
    const d=document.createElement("div");
    d.className="day";
    if(dateStr===todayStr)d.classList.add("today");
    d.innerHTML=`<b>${i}</b> <span class="icon" onclick="addSchedule('${dateStr}')">â•</span>`;
    d.onclick=()=>loadSchedules(dateStr);
    if(dates.includes(dateStr)){
      const dot=document.createElement("div");
      dot.className="dot";
      d.appendChild(dot);
    }
    calendar.appendChild(d);
  }
  loadSchedules(selectedDate);
}

function addSchedule(date){
  const text=prompt("ì¼ì • ì…ë ¥");
  if(!text)return;
  db.collection("schedules").add({uid:user.uid,date,text}).then(drawCalendar);
}

async function loadSchedules(date){
  selectedDate=date;
  scheduleList.innerHTML="";
  const snap=await db.collection("schedules")
    .where("uid","==",user.uid)
    .where("date","==",date)
    .get();

  snap.forEach(doc=>{
    const div=document.createElement("div");
    div.className="schedule-item";
    div.innerHTML=`
      ${doc.data().text}
      <span>
        <span class="icon" onclick="editSchedule('${doc.id}','${doc.data().text}')">âœï¸</span>
        <span class="icon" onclick="deleteSchedule('${doc.id}')">âŒ</span>
      </span>
    `;
    scheduleList.appendChild(div);
  });
}

function editSchedule(id,oldText){
  const text=prompt("ìˆ˜ì •",oldText);
  if(!text)return;
  db.collection("schedules").doc(id).update({text}).then(drawCalendar);
}
function deleteSchedule(id){
  db.collection("schedules").doc(id).delete().then(drawCalendar);
}

/* âœ… Todo */
async function loadTodos(){
  todoList.innerHTML="";
  const snap=await db.collection("todos").where("uid","==",user.uid).get();
  snap.forEach(doc=>{
    const div=document.createElement("div");
    div.className="todo-item";
    div.innerHTML=`${doc.data().text}<span class="icon" onclick="deleteTodo('${doc.id}')">âŒ</span>`;
    todoList.appendChild(div);
  });
}
function addTodo(){
  const v=todoInput.value;
  if(!v)return;
  db.collection("todos").add({uid:user.uid,text:v});
  db.collection("schedules").add({uid:user.uid,date:todayStr,text:v}).then(drawCalendar);
  todoInput.value="";
  loadTodos();
}
function deleteTodo(id){
  db.collection("todos").doc(id).delete().then(loadTodos);
}

/* â± ê³µë¶€ ì‹œê°„ */
let startTime=null;

function startStudy(){
  startTime=Date.now();
  alert("ê³µë¶€ ì‹œì‘!");
}
async function stopStudy(){
  if(!startTime)return;
  const minutes=Math.floor((Date.now()-startTime)/60000);
  startTime=null;

  const ref=db.collection("studyTime").doc(`${user.uid}_${todayStr}`);
  const doc=await ref.get();

  if(doc.exists){
    ref.update({minutes:doc.data().minutes+minutes});
  }else{
    ref.set({uid:user.uid,date:todayStr,minutes});
  }
  loadStudyTime();
}

async function loadStudyTime(){
  const ref=db.collection("studyTime").doc(`${user.uid}_${todayStr}`);
  const doc=await ref.get();
  studyTime.innerText=doc.exists
    ? `ì˜¤ëŠ˜ ê³µë¶€ ì‹œê°„: ${doc.data().minutes}ë¶„`
    : "ì˜¤ëŠ˜ ê³µë¶€ ê¸°ë¡ ì—†ìŒ";
}
</script>

</body>
</html>
